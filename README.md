# Hono My Router Module

Un m√≥dulo avanzado de enrutamiento para Hono que proporciona escaneo autom√°tico de archivos de rutas, extracci√≥n de par√°metros tipada y manejo robusto de errores.

## üöÄ Caracter√≠sticas

- **Escaneo Autom√°tico**: Detecta autom√°ticamente archivos de rutas en tu estructura de carpetas
- **Tipado TypeScript**: Soporte completo para TypeScript con tipos seguros
- **Rutas Din√°micas**: Soporte para par√°metros √∫nicos, m√∫ltiples y segmentos variables
- **Validaci√≥n de Par√°metros**: Validaci√≥n autom√°tica de par√°metros con configuraci√≥n personalizable
- **Manejo de Errores**: Sistema robusto de manejo de errores 404 y validaci√≥n
- **Rutas Anidadas**: Soporte completo para rutas anidadas complejas
- **Metadatos de Rutas**: Sistema de metadatos para documentaci√≥n y configuraci√≥n

## üîß Optimizaci√≥n de Rendimiento

### Uso de path-to-regexp para Maximizar Tiempos de Respuesta

Este m√≥dulo utiliza la librer√≠a `path-to-regexp` para optimizar significativamente el rendimiento del enrutamiento mediante t√©cnicas avanzadas de compilaci√≥n y matching de patrones:


#### ‚ö° Matching Optimizado con Expresiones Regulares

- **Compilaci√≥n √önica**: Los patrones de rutas se compilan a expresiones regulares optimizadas durante la inicializaci√≥n del router
- **Matching Nativo**: Utiliza el motor de RegExp nativo del JavaScript engine para matching ultra-r√°pido
- **Extracci√≥n Eficiente**: Los par√°metros se extraen en una sola pasada usando grupos de captura nombrados

#### üìä Ventajas de Rendimiento

| Aspecto | String Matching Manual | path-to-regexp |
|---------|----------------------|----------------|
| **Compilaci√≥n** | En cada request | Una sola vez |
| **Matching** | O(n) iterativo | O(1) RegExp nativo |
| **Extracci√≥n de Par√°metros** | Parsing manual | Grupos de captura |
| **Memoria** | Rec√°lculo constante | Cache optimizado |
| **CPU** | Alto uso por request | M√≠nimo uso por request |

## üì¶ Instalaci√≥n

```bash
npm install hono-my-router
# o
pnpm add hono-my-router
# o
yarn add hono-my-router
```

## üõ†Ô∏è Uso B√°sico

### Configuraci√≥n R√°pida

```typescript
import { createHonoRouterApp } from 'hono-my-router';

// Crear aplicaci√≥n con router configurado
const { app, router, result } = await createHonoRouterApp({
  routesDirectory: './src/routes',
  enableLogging: true,
  enableParameterValidation: true
});

// Iniciar servidor
export default {
  port: 3000,
  fetch: app.fetch
};
```

### Configuraci√≥n Manual

```typescript
import { Router } from 'hono-my-router';
import { Hono } from 'hono';

const app = new Hono();
const router = new Router({
  routesDirectory: './src/routes',
  enableLogging: true,
  enableParameterValidation: true,
  errorHandling: {
    enable404Handler: true,
    enableValidationErrors: true
  }
});

// Inicializar router
const result = await router.initialize();

// Montar rutas
app.route('/', router.getApp());

console.log(`Router inicializado con ${result.totalRoutes} rutas`);
```

## üìÅ Estructura de Archivos de Rutas

### Tipos de Rutas Soportadas

#### 1. Rutas Simples
```
src/routes/api/users/index.ts ‚Üí /api/users
src/routes/api/health.ts ‚Üí /api/health
```

#### 2. Par√°metros √önicos
```
src/routes/api/users/[id].ts ‚Üí /api/users/:id
src/routes/api/posts/[slug].ts ‚Üí /api/posts/:slug
```

#### 3. Rutas Anidadas
```
src/routes/api/users/[id]/profile.ts ‚Üí /api/users/:id/profile
src/routes/api/users/[id]/posts/[postId].ts ‚Üí /api/users/:id/posts/:postId
```

#### 4. Segmentos Variables
```
src/routes/api/products/[...segments].ts ‚Üí /api/products/*
```

## üìù Definici√≥n de Handlers

### Handler B√°sico

```typescript
// src/routes/api/users/index.ts
import { ExtendedContext } from 'hono-my-router/types';

export async function get(c: ExtendedContext) {
  return c.json({
    success: true,
    data: await getUsers(),
    route: c.route
  });
}

export async function post(c: ExtendedContext) {
  const body = await c.req.json();
  const user = await createUser(body);
  
  return c.json({
    success: true,
    data: user
  }, 201);
}
```

### Handler con Par√°metros

```typescript
// src/routes/api/users/[id].ts
import { ExtendedContext } from 'hono-my-router/types';

export async function get(c: ExtendedContext) {
  const { id } = c.params; // Tipado autom√°tico
  const user = await getUserById(parseInt(id));
  
  if (!user) {
    return c.json({ error: 'User not found' }, 404);
  }
  
  return c.json({
    success: true,
    data: user,
    params: c.params
  });
}

// Configuraci√≥n de validaci√≥n
export const paramValidation = {
  id: {
    type: 'number',
    required: true,
    min: 1
  }
};
```

### Handler con Segmentos Variables

```typescript
// src/routes/api/products/[...segments].ts
import { ExtendedContext } from 'hono-my-router/types';

export async function get(c: ExtendedContext) {
  const { segments } = c.params;
  // segments = ['electronics', 'phones', 'smartphones']
  
  const products = await getProductsByCategory(segments);
  
  return c.json({
    success: true,
    data: products,
    categoryPath: segments
  });
}

export const paramValidation = {
  segments: {
    type: 'array',
    required: true,
    minLength: 1,
    maxLength: 5
  }
};
```

## ‚öôÔ∏è Configuraci√≥n

### RouterConfig

```typescript
interface RouterConfig {
  routesDirectory: string;              // Directorio de rutas
  enableLogging?: boolean;              // Habilitar logging
  enableParameterValidation?: boolean;  // Validaci√≥n de par√°metros
  errorHandling?: {
    enable404Handler?: boolean;         // Handler 404 autom√°tico
    enableValidationErrors?: boolean;   // Errores de validaci√≥n
  };
}
```

### Validaci√≥n de Par√°metros

```typescript
export const paramValidation = {
  id: {
    type: 'number',
    required: true,
    min: 1,
    max: 999999,
    description: 'User ID'
  },
  slug: {
    type: 'string',
    required: true,
    pattern: /^[a-z0-9-]+$/,
    minLength: 3,
    maxLength: 50
  },
  segments: {
    type: 'array',
    required: true,
    minLength: 1,
    maxLength: 10
  }
};
```

### Metadatos de Rutas

```typescript
export const routeMetadata = {
  description: 'Gesti√≥n de usuarios',
  tags: ['users', 'crud'],
  version: '1.0.0',
  parameters: {
    id: {
      type: 'integer',
      description: 'Unique user identifier',
      example: 123
    }
  }
};
```

## üîß API Avanzada

### Funciones de Utilidad

```typescript
import {
  createHonoRouterApp,
  setupRoutes,
  validateRouterConfig,
  createDefaultConfig,
  normalizePath,
  extractRouteParameters
} from 'hono-my-router';

// Crear aplicaci√≥n completa
const { app, router } = await createHonoRouterApp(config);

// Configurar rutas en app existente
const existingApp = new Hono();
const { router } = await setupRoutes(existingApp, config);

// Validar configuraci√≥n
const { isValid, errors } = validateRouterConfig(config);

// Crear configuraci√≥n por defecto
const defaultConfig = createDefaultConfig({ enableLogging: true });
```

### Estad√≠sticas del Router

```typescript
const stats = router.getStats();
console.log({
  totalRoutes: stats.totalRoutes,
  lastScanTime: stats.lastScanTime,
  routesByType: stats.routesByType
});
```

### Informaci√≥n de Rutas Registradas

```typescript
const routes = router.getRegisteredRoutes();
routes.forEach(route => {
  console.log({
    path: route.path,
    type: route.type,
    methods: route.methods,
    filePath: route.filePath
  });
});
```

## üö® Manejo de Errores

### Errores 404 Autom√°ticos

```typescript
// Configuraci√≥n autom√°tica de 404
const router = new Router({
  routesDirectory: './src/routes',
  errorHandling: {
    enable404Handler: true
  }
});
```

### Errores de Validaci√≥n

```typescript
// Los errores de validaci√≥n se manejan autom√°ticamente
// Respuesta autom√°tica para par√°metros inv√°lidos:
{
  "success": false,
  "error": "Validation failed",
  "details": {
    "id": "Must be a number between 1 and 999999"
  }
}
```

### Handler de Errores Personalizado

```typescript
import { ErrorHandler } from 'hono-my-router';

const errorHandler = new ErrorHandler({
  enable404Handler: true,
  enableValidationErrors: true
});

// Personalizar respuesta 404
errorHandler.handle404 = async (c) => {
  return c.json({
    error: 'Ruta no encontrada',
    path: c.req.path,
    method: c.req.method,
    timestamp: new Date().toISOString()
  }, 404);
};
```

## üìä Ejemplos Completos

### Ejemplo 1: API REST B√°sica

```typescript
// src/app.ts
import { createHonoRouterApp } from 'hono-my-router';

const { app } = await createHonoRouterApp({
  routesDirectory: './src/routes',
  enableLogging: true,
  enableParameterValidation: true
});

export default app;
```

```typescript
// src/routes/api/users/index.ts
export async function get(c) {
  return c.json({ users: await getUsers() });
}

export async function post(c) {
  const user = await createUser(await c.req.json());
  return c.json({ user }, 201);
}
```

### Ejemplo 2: API con Autenticaci√≥n

```typescript
// src/routes/api/protected/[...path].ts
import { ExtendedContext } from 'hono-my-router/types';

export async function get(c: ExtendedContext) {
  // Verificar autenticaci√≥n
  const token = c.req.header('Authorization');
  if (!token) {
    return c.json({ error: 'Unauthorized' }, 401);
  }
  
  const { path } = c.params;
  return c.json({
    message: `Acceso autorizado a: ${path.join('/')}`,
    user: await getUserFromToken(token)
  });
}
```

## üß™ Testing

```bash
# Ejecutar tests
npm test

# Tests con cobertura
npm run test:coverage

# Tests en modo watch
npm run test:watch
```

## üìã Scripts Disponibles

```bash
npm run build      # Compilar TypeScript
npm run dev        # Modo desarrollo con watch
npm run test       # Ejecutar tests
npm run lint       # Linter ESLint
npm run clean      # Limpiar archivos compilados
```

## ü§ù Contribuir

1. Fork el repositorio
2. Crea una rama para tu feature (`git checkout -b feature/amazing-feature`)
3. Commit tus cambios (`git commit -m 'Add amazing feature'`)
4. Push a la rama (`git push origin feature/amazing-feature`)
5. Abre un Pull Request

## üìÑ Licencia

MIT License - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## üîó Enlaces

- [Documentaci√≥n de Hono](https://hono.dev/)
- [TypeScript](https://www.typescriptlang.org/)
- [Repositorio](https://github.com/tu-usuario/hono-my-router)

---

**Hecho con ‚ù§Ô∏è para la comunidad de Hono**